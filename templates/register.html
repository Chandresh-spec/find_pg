{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PG Finder Signup</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="{% static 'register.css' %}">
</head>
<body>

<div id="chat-form">

    <div id="logo">üè† PG Finder</div>

    <!-- Step 1 -->
    <div id="msg1" class="message active">
        <label>What's your name?</label><br>
        <input type="text" id="input1" placeholder="Enter your name">
        <br><button id="next1">Next</button>
    </div>

    <!-- Step 2 -->
    <div id="msg2" class="message">
        <label>Enter your email:</label><br>
        <input type="email" id="input2" placeholder="Enter your email">
        <br><button id="next2">Next</button>
    </div>

    <!-- Step 3 -->
    <div id="msg3" class="message">
        <label>Phone number:</label><br>
        <input type="text" id="input3" placeholder="Enter your phone">
        <br><button id="next3">Next</button>
    </div>

    <!-- Step 4 -->
    <div id="msg4" class="message">
        <label>Create a password:</label><br>
        <input type="password" id="input4" placeholder="Enter your password">
        <br><button id="next4">Next</button>
    </div>

    <!-- Step 5 -->
    <div id="msg5" class="message">
        <label>Profile picture:</label><br>
        <input type="file" id="input5" accept="image/*">
        <br><button id="next5">Next</button>
    </div>

    <!-- Step 6 -->
    <div id="msg6" class="message">
        <label>Write a short bio:</label><br>
        <textarea id="input6" placeholder="Tell us about yourself" rows="3"></textarea>
        <br><button id="submit">Submit</button>
    </div>

    <!-- Progress dots -->
    <div id="progress">
        <span class="dot active"></span>
        <span class="dot"></span>
        <span class="dot"></span>
        <span class="dot"></span>
        <span class="dot"></span>
        <span class="dot"></span>
    </div>

</div>

<script>
function sendStep(stepNum, data, nextId, stepIndex) {
    $.ajax({
        url: "{% url 'register' %}",
        type: 'POST',
        data: data,
        processData: false,
        contentType: false,
        success: function(response){
            if(response.success){
                $('#msg'+stepNum).removeClass('active');
                if(nextId) {
                    $(nextId).addClass('active');
                    $(nextId + ' input, '+nextId+' textarea').focus();
                    $('#progress .dot').removeClass('active');
                    $('#progress .dot').eq(stepIndex).addClass('active');
                } else {
                    alert("All steps completed!");
                    // Optionally redirect or reset form here
                }
            } else {
                alert(JSON.stringify(response.errors));
            }
        }
    });
}

// Step 1
$('#next1').click(function(){
    let fd = new FormData();
    fd.append('name', $('#input1').val());
    fd.append('step', '1');
    fd.append('csrfmiddlewaretoken', '{{ csrf_token }}');
    sendStep(1, fd, '#msg2', 1);
});

// Step 2
$('#next2').click(function(){
    let fd = new FormData();
    fd.append('email', $('#input2').val());
    fd.append('step', '2');
    fd.append('csrfmiddlewaretoken', '{{ csrf_token }}');
    sendStep(2, fd, '#msg3', 2);
});

// Step 3
$('#next3').click(function(){
    let fd = new FormData();
    fd.append('phone', $('#input3').val());
    fd.append('step', '3');
    fd.append('csrfmiddlewaretoken', '{{ csrf_token }}');
    sendStep(3, fd, '#msg4', 3);
});

// Step 4
$('#next4').click(function(){
    let fd = new FormData();
    fd.append('password', $('#input4').val());
    fd.append('step', '4');
    fd.append('csrfmiddlewaretoken', '{{ csrf_token }}');
    sendStep(4, fd, '#msg5', 4);
});

// Step 5
$('#next5').click(function(){
    let fd = new FormData();
    fd.append('profile_picture', $('#input5')[0].files[0]);
    fd.append('step', '5');
    fd.append('csrfmiddlewaretoken', '{{ csrf_token }}');
    sendStep(5, fd, '#msg6', 5);
});

// Step 6
$('#submit').click(function(){
    let fd = new FormData();
    fd.append('bio', $('#input6').val());
    fd.append('step', '6');
    fd.append('csrfmiddlewaretoken', '{{ csrf_token }}');
    sendStep(6, fd, null, 5);
});
</script>

</body>
</html>
